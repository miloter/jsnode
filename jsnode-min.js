/**
 * @summary JsNode es una especie de jQuery reducido usando solo ES6+ y
 * el sistema de Promises/async/await donde es necesario.
 * @copyright miloter
 * @license MIT
 * @since 2025-06-06 
 * @version 0.3.0 2025-06-14
 */
class JsNode{#e;constructor(e=[]){e instanceof Array||(e=[e]),this.#e=e}static#t(e,t){if(!e.listeners)return;const s=e.listeners[t];for(const n of s)e.removeEventListener(t,n);delete e.listeners[t]}static#s(e,t,s){null===s?e.removeAttribute(t):e.setAttribute(t,s)}static async#n(e,t){const s={};return s.response=e,s.data="json"===t?await e.json():"text"===t?await e.text():await e.blob(),s}static async#o(e,t,s,n){let o,r;return"json"===(n=n.toLowerCase())?(o={"Content-Type":"application/json"},r=JSON.stringify(s)):(o={"Content-Type":"application/x-www-form-urlencoded"},r=this.objectToUrlEncoded(s)),fetch(e,{credentials:"include",headers:o,method:t,body:r}).then((e=>JsNode.#n(e,n)))}static async#r(e,t,s,n){return n=n.toLowerCase(),(s=this.objectToUrlEncoded(s))&&(e+="?"+s),fetch(e,{credentials:"include",method:t}).then((e=>JsNode.#n(e,n)))}static domLoaded(){return new Promise(((e,t)=>{try{"complete"===document.readyState||"interactive"===document.readyState?e(new JsNode):document.addEventListener("DOMContentLoaded",(()=>e(new JsNode)))}catch(e){t(e)}}))}static loadLibs(e){return new Promise(((s,n)=>{try{"complete"===document.readyState||"interactive"===document.readyState?s(t(e)):document.addEventListener("DOMContentLoaded",(()=>s(t(e))))}catch(e){n(e)}}));async function t(e){for(let t of e){let e;const n=typeof t;try{e="string"===n?await s(t):"object"===n&&await s(t.path,t.endBody,t.type,t.noExtension)}catch{throw new Error(`No se pudo cargar: '${"string"===n?t:t.path}'`)}}return!0}function s(e,t,s,n){return new Promise(((o,r)=>{let i,a;if(e.toLowerCase().endsWith(".js")?(i=document.createElement("script"),i.src=e,a="js"):e.toLowerCase().endsWith(".css")?(i=document.createElement("link"),i.href=e,i.rel="stylesheet",a="css"):n&&(i=document.createElement("script"),i.src=e,a="noExtension"),!a)return r(!1);s&&"string"==typeof s&&(i.type=s),i.onload=function(e){o(!0)},i.onerror=function(e){r(!1)};try{t?document.body.append(i):document.head.append(i)}catch{r(!1)}}))}}static select(e){let t;try{t=e instanceof HTMLElement?e:e instanceof NodeList?Array.from(e):e instanceof Array?e:Array.from(document.querySelectorAll(e))}catch(e){t=[]}return new JsNode(t)}static dateParts(e){const t=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],s=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],n={},o=(e=void 0!==e?new Date(e):new Date).getDay();e.setMinutes(e.getMinutes()-e.getTimezoneOffset());const r=/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d).(\d{3})Z$/.exec(e.toISOString());r.push(o,t[o],s[n.mon-1]),["year","mon","mday","hours","minutes","seconds","milliseconds"].forEach(((e,t)=>n[e]=parseInt(r[t+1]))),n.weekday=t[o],n.wday=0===o?7:o,n.month=s[n.mon-1];const i=new Date(e.getFullYear(),0,1);return n.yday=Math.ceil((e-i+1)/864e5),n.epoch=e.getTime(),n.offset=e.getTimezoneOffset(),n}static isLeapYear(e){return e%4==0&&e%100!=0||e%400==0}static dateFormat(e="d/m/Y H:i:s:u",t){const s=this.dateParts(t),n=[];function o(e,t=2){const o=s[e].toString();t>=0?n.push(o.padStart(t,"0")):n.push(o)}let r=!1;for(const t of e)if(r)n.push(t),r=!1;else switch(t){case"D":n.push(s.weekday.substring(0,3));break;case"F":o("month");break;case"G":o("hours",-1);break;case"H":o("hours");break;case"L":n.push(JsNode.isLeapYear(s.year)?"1":"0");break;case"M":n.push(s.month.substring(0,3));break;case"U":o("epoch",-1);break;case"Y":o("year",4);break;case"Z":o("offset",-1);break;case"d":o("mday");break;case"i":o("minutes");break;case"j":o("mday",-1);break;case"l":o("weekday");break;case"m":o("mon");break;case"n":o("mon",-1);break;case"s":o("seconds");break;case"t":let e;e=[1,3,5,7,8,10,12].includes(s.mon)?"31":[4,6,9,11].includes(s.mon)?"30":JsNode.isLeapYear(s.year)?"29":"28",n.push(e);break;case"u":o("milliseconds",3);break;case"w":o("wday",1);break;case"y":n.push(s.year.toString().padStart(4,"0").substring(2));break;case"z":o("yday",-1);break;case"\\":r=!0;break;default:n.push(t)}return n.join("")}static objectToUrlEncoded(e){let t="";for(let s in e)t&&(t+="&"),t+=s+"="+encodeURIComponent(e[s]);return t}static async post(e,t={},s="text"){return JsNode.#o(e,"POST",t,s)}static async put(e,t={},s="text"){return JsNode.#o(e,"PUT",t,s)}static async get(e,t={},s="text"){return JsNode.#r(e,"GET",t,s)}static async delete(e,t={},s="text"){return JsNode.#r(e,"DELETE",t,s)}static strToB64(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(parseInt(t,16)))))}static b64ToStr(e){const t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return(new TextDecoder).decode(n)}static fileToDataUrl(e){return new Promise(((t,s)=>{try{const s=new FileReader;s.addEventListener("load",(e=>t(e.target.result))),s.readAsDataURL(e)}catch(e){s(e)}}))}static b64ToUint8(e){const t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return n}static strToUint8(e){return(new TextEncoder).encode(e)}static uInt8ToStr(e){return(new TextDecoder).decode(e)}static blobToUint8(e){return new Promise((async(t,s)=>{try{t(new Uint8Array(await e.arrayBuffer()))}catch(e){s(e)}}))}static uInt8ToBlob(e,t){return new Blob([e],{type:t})}static blobToFile(e,t){return new File([e],t,{type:e.type})}static fileToBlob(e){return new Promise((async(t,s)=>{try{const s=await e.arrayBuffer();t(new Blob([new Uint8Array(s)],{type:e.type}))}catch(e){s(e)}}))}static get qsMap(){const e={},t=decodeURIComponent(location.search.substring(1).replace(/\+/g," "));if(t){const s=t.split("&");for(let t=0;t<s.length;t++)e[s[t].substring(0,s[t].indexOf("="))]=s[t].substring(s[t].indexOf("=")+1)}return e}static isNumber(e){return isFinite(Number(e))}static isInteger(e){return JsNode.isNumber(e)&&e==Math.floor(e)}static randInt(e,t){return Math.floor((t-e+1)*Math.random()+e)}static randDec(e,t){return(t-e)*Math.random()+e}static setCookie(e,t,s,n,o,r){let i=e+"="+encodeURIComponent(t);void 0!==s&&(i+="; expires="+s.toGMTString()),void 0!==n&&(i+="; domain="+n),void 0!==o&&(i+="; path="+o),void 0!==r&&r&&(i+="; secure"),document.cookie=i}static getCookie(e){if(0!=document.cookie.length){let t=document.cookie.indexOf(e+"=");if(t>=0){t+=e.length+1;let s=document.cookie.indexOf(";",t);return s=s>=0?s:document.cookie.length,decodeURIComponent(document.cookie.substring(t,s))}}return""}static getTypeName(e){return/^\[object (\w+)\]$/.exec(Object.prototype.toString.call(e))[1]}css(e,t){return void 0!==t?(this.#e.forEach((s=>{s.style[e]=t})),this):"object"==typeof e?(this.#e.forEach((t=>{for(const s in e)t.style[s]=e[s]})),this):this.#e[0]?.style[e]}filterText(e,t=!1,s=!1){return t&&(e=e.normalize("NFD").toLowerCase().replace(/[\u0300-\u036f]/g,"")),this.#e=this.#e.filter((n=>{let o;return o=t?n.innerText.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().indexOf(e)>=0:n.innerText.indexOf(e)>=0,s?!o:o})),this}filterRegExp(e,t="",s=!1,n){const o=new RegExp(e,t);return this.#e=this.#e.filter((e=>{let t;return"function"==typeof n?(t=o.exec(e.innerText),t&&(t=n(t)),t=!!t):t=o.test(e.innerText),s?!t:t})),this}select(e){let t=[];for(const s of this.#e){const n=Array.from(s.querySelectorAll(e));t=t.concat(n)}return new JsNode(t)}filter(e,t=!1){return this.#e=this.#e.filter(((s,n,o)=>{let r;return r="function"==typeof e?!!e(s,n,o):s.matches(e),t?!r:r})),this}text(e){if(void 0===e){let e="";for(const t of this.#e)e+=t.innerText;return e}return this.#e.forEach(((t,s)=>{t.innerText="function"!=typeof e?e:e(t.innerText,s)})),this}html(e){return void 0===e?this.#e[0]?.innerHTML:(this.#e.forEach(((t,s)=>{t.innerHTML="function"!=typeof e?e:e(t.innerHTML,s)})),this)}val(e){return void 0===e?this.#e[0]?.value:(this.#e.forEach(((t,s)=>{t.value="function"!=typeof e?e:e(t.value,s)})),this)}attr(e,t){return void 0!==t?(this.#e.forEach(((s,n)=>{"function"!=typeof t?JsNode.#s(s,e,t):JsNode.#s(s,e,t(s.getAttribute(e),n))})),this):"object"==typeof e?(this.#e.forEach((t=>{for(const s in e)JsNode.#s(t,s,e[s])})),this):this.#e[0]?.getAttribute(e)}prop(e,t){return void 0!==t?(this.#e.forEach(((s,n)=>{s[e]="function"!=typeof t?t:t(s[e],n)})),this):"object"==typeof e?(this.#e.forEach((t=>{for(const s in e)t[s]=e[s]})),this):this.#e[0]?.[e]}after(e){for(const t of this.#e)e instanceof HTMLElement?t.insertAdjacentElement("afterend",e):t.insertAdjacentHTML("afterend",e);return this}before(e){for(const t of this.#e)e instanceof HTMLElement?t.insertAdjacentElement("beforebegin",e):t.insertAdjacentHTML("beforebegin",e);return this}append(e){for(const t of this.#e)e instanceof HTMLElement?t.insertAdjacentElement("beforeend",e):t.insertAdjacentHTML("beforeend",e);return this}prepend(e){for(const t of this.#e)e instanceof HTMLElement?t.insertAdjacentElement("afterbegin",e):t.insertAdjacentHTML("afterbegin",e);return this}parent(e){const t=[];for(const s of this.#e){const n=s.parentElement;!n||t.includes(n)||void 0!==e&&!n.matches(e)||t.push(n)}return new JsNode(t)}parents(e,t=!0,s){const n=[];for(const o of this.#e){let r=o.parentElement;for(;r&&(void 0===s||!r.matches(s))&&(n.includes(r)||void 0!==e&&!r.matches(e)||(n.push(r),void 0===e||!t));)r=r.parentElement}return new JsNode(n)}parentsUntil(e){return this.parents(void 0,!1,e)}children(e){let t=[];for(const s of this.#e){const n=Array.from(s.children).filter((t=>void 0===e||t.matches(e)));t=t.concat(n)}return new JsNode(t)}siblings(e,t=0,s){let n=[];for(const o of this.#e){let r;if(t<=0)for(r=o.previousElementSibling;r&&(void 0===e||r.matches(e))&&!n.includes(r)&&(void 0===s||!r.matches(s));)n.unshift(r),r=r.previousElementSibling;if(t>=0)for(r=o.nextElementSibling;r&&(void 0===e||r.matches(e))&&!n.includes(r)&&(void 0===s||!r.matches(s));)n.push(r),r=r.nextElementSibling}return new JsNode(n)}next(e){const t=[];for(const s of this.#e){const n=s.nextElementSibling;n&&(void 0===e||n.matches(e))&&t.push(n)}return new JsNode(t)}nextAll(e){return this.siblings(e,1)}nextUntil(e){return this.siblings(void 0,1,e)}prev(e){const t=[];for(const s of this.#e){const n=s.previousElementSibling;n&&(void 0===e||n.matches(e))&&t.push(s.previousElementSibling)}return new JsNode(t)}prevAll(e){return this.siblings(e,-1)}prevUntil(e){return this.siblings(void 0,-1,e)}addClass(e){const t=e.trim().split(/\s+/);return this.#e.forEach((e=>{t.forEach((t=>e.classList.add(t)))})),this}removeClass(e){const t=e.trim().split(/\s+/);return this.#e.forEach((e=>{t.forEach((t=>e.classList.remove(t)))})),this}toggleClass(e){const t=e.trim().split(/\s+/);return this.#e.forEach((e=>{t.forEach((t=>{e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)}))})),this}hide(){for(const e of this.#e)e.style.display="none";return this}show(){for(const e of this.#e)e.style.display="";return this}get visible(){if(this.#e[0]){const e=getComputedStyle(this.#e[0]);return"none"!==e.display&&"hidden"!==e.visibility}return!1}toggle(){for(const e of this.#e)e.style.display=""===e.style.display?"none":"";return this}focus(){for(const e of this.#e)e.focus();return this}click(){for(const e of this.#e)e.click();return this}remove(){for(;this.#e.length;)this.#e.at(-1).remove(),this.#e.pop();return this}one(e=0){return new JsNode(this.#e.at(e))}get nodes(){return this.#e}get length(){return this.#e.length}on(e,t){for(const s of this.#e){s.listeners||(s.listeners={}),s.listeners[e]||(s.listeners[e]=[]);const n=t.bind(new JsNode(s));s.addEventListener(e,n),s.listeners[e].push(n)}return this}off(e){for(const t of this.#e)if(e)JsNode.#t(t,e);else if(t.listeners)for(const e in t.listeners)JsNode.#t(t,e);return this}width(e){return void 0===e?this.#e[0]?parseFloat(getComputedStyle(this.#e[0]).width):void 0:("number"==typeof e&&(e+="px"),this.#e.forEach(((t,s)=>{if("function"!=typeof e)t.style.width=e;else{let n=e(parseFloat(getComputedStyle(t).width),s);"number"==typeof n&&(n+="px"),t.style.width=n}})),this)}height(e){return void 0===e?this.#e[0]?parseFloat(getComputedStyle(this.#e[0]).height):void 0:("number"==typeof e&&(e+="px"),this.#e.forEach(((t,s)=>{if("function"!=typeof e)t.style.height=e;else{let n=e(parseFloat(getComputedStyle(t).height),s);"number"==typeof n&&(n+="px"),t.style.height=n}})),this)}innerWidth(e){if(void 0!==e)return"number"==typeof e&&(e+="px"),this.#e.forEach(((t,s)=>{const n=getComputedStyle(t),o=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight);if("function"!=typeof e)t.style.width=e;else{let r=e(parseFloat(n.width)+o,s);"number"==typeof r&&(r+="px"),t.style.width=r}t.style.width=parseFloat(n.width)-o+"px"})),this;if(this.#e[0]){const e=getComputedStyle(this.#e[0]);return parseFloat(e.width)+parseFloat(e.paddingLeft)+parseFloat(e.paddingRight)}}innerHeight(e){if(void 0!==e)return"number"==typeof e&&(e+="px"),this.#e.forEach(((t,s)=>{const n=getComputedStyle(t),o=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom);if("function"!=typeof e)t.style.height=e;else{let r=e(parseFloat(n.height)+o,s);"number"==typeof r&&(r+="px"),t.style.height=r}t.style.height=parseFloat(n.height)-o+"px"})),this;if(this.#e[0]){const e=getComputedStyle(this.#e[0]);return parseFloat(e.height)+parseFloat(e.paddingTop)+parseFloat(e.paddingBottom)}}outerWidth(e,t=!1){if(void 0!==e&&"boolean"!=typeof e)return"number"==typeof e&&(e+="px"),this.#e.forEach(((s,n)=>{const o=getComputedStyle(s),r=parseFloat(o.paddingLeft)+parseFloat(o.paddingRight)+parseFloat(o.borderLeftWidth)+parseFloat(o.borderRightWidth)+(t?parseFloat(o.marginLeft)+parseFloat(o.marginRight):0);if("function"!=typeof e)s.style.width=e;else{let t=e(parseFloat(o.width)+r,n);"number"==typeof t&&(t+="px"),s.style.width=t}s.style.width=parseFloat(o.width)-r+"px"})),this;if(this.#e[0]){const t=getComputedStyle(this.#e[0]);return parseFloat(t.width)+parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)+parseFloat(t.borderLeftWidth)+parseFloat(t.borderRightWidth)+(e?parseFloat(t.marginLeft)+parseFloat(t.marginRight):0)}}}